<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Liquidity | SolMint</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.73.0/lib/index.iife.min.js"></script>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Header -->
    <header class="bg-blue-600 text-white p-6">
        <div class="flex justify-center items-center flex-col">
            <h1 class="text-3xl font-bold">SolMint</h1>
            <nav class="mt-4 flex justify-center space-x-8">
                <a href="create-token.html" class="bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">
                    Create Token
                </a>
                <a href="create-liquidity.html" class="bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">
                    Create Liquidity Pool
                </a>
                <button id="connectWalletButton" onclick="connectWallet()" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400">
                    Connect Wallet
                </button>
                <select id="networkSelect" onchange="updateNetwork()" class="bg-white text-blue-600 border rounded-md py-2 px-4 hover:border-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-600 transition duration-300">
                    <option value="devnet">Devnet</option>
                    <option value="testnet">Testnet</option>
                    <option value="mainnet">Mainnet</option>
                </select>
            </nav>
        </div>
    </header>

    <main class="p-8 grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Liquidity Creation Section -->
        <section class="bg-white p-6 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold mb-6">Create Liquidity</h2>
            <form>
                <label for="baseToken" class="block text-sm font-medium">Base Token</label>
                <select id="baseToken" class="w-full p-3 border rounded-md mb-4">
                </select>
                <label for="quoteToken" class="block text-sm font-medium">Quote Token</label>
                <select id="quoteToken" class="w-full p-3 border rounded-md mb-4">
                </select>
                <label for="liquidityAmount" class="block text-sm font-medium">Liquidity Amount</label>
                <input type="number" id="liquidityAmount" class="w-full p-3 border rounded-md mb-4" placeholder="Enter amount">
                <label for="feeTier" class="block text-sm font-medium">Fee Tier</label>
                <select id="feeTier" class="w-full p-3 border rounded-md mb-4">
                    <option value="0.25">0.25%</option>
                    <option value="0.5">0.5%</option>
                    <option value="1">1%</option>
                    <option value="2">2%</option>
                    <option value="4">4%</option>
                </select>
                <button id="createLiquidityButton" class="bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700">Create Liquidity</button>
            </form>
        </section>
        <section class="bg-white p-6 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold mb-6">How Liquidity Pools Work</h2>
            <p class="text-gray-700 mb-4">
                A liquidity pool is a collection of funds locked in a smart contract. These pools are used by decentralized exchanges (DEXes) to facilitate trading. By contributing to liquidity pools, you help ensure that there is enough supply for traders to execute buy and sell orders.
            </p>
            <p class="text-gray-700 mb-4">
                When you add liquidity to a pool, you provide two assets (such as SOL and USDC) in a specific ratio. The pool facilitates trades between these assets. In return, you earn a portion of the transaction fees generated by the trades within the pool, based on the amount of liquidity youâ€™ve contributed.
            </p>
            <p class="text-gray-700 mb-4">
                The fee you can earn depends on the fee tier set for the pool. The higher the fee tier, the higher the reward for liquidity providers. However, this also comes with increased risk, as prices can fluctuate more significantly at higher fee tiers.
            </p>
            <p class="text-gray-700">
                Liquidity pools play a vital role in decentralized finance (DeFi) by improving market efficiency, reducing slippage, and providing users with an opportunity to earn passive income from their digital assets.
            </p>
        </section>
    </main>

    <footer class="bg-blue-600 text-white p-6 text-center mt-auto">
        <div class="container mx-auto">
            <p>&copy; 2024 SolMint</p>
        </div>
    </footer>

    <script>
        // Initialize Solana connection and state
        let connection;
        let walletPublicKey = null;
        let selectedNetwork = 'devnet'; // Default network

        // Initialize connection on page load
        window.addEventListener('load', () => {
            initializeConnection(selectedNetwork);
            populateBaseTokenDropdown();
        });

        function initializeConnection(network) {
            const networks = {
                'devnet': 'https://api.devnet.solana.com',
                'testnet': 'https://api.testnet.solana.com',
                'mainnet': 'https://api.mainnet-beta.solana.com'
            };
            connection = new solanaWeb3.Connection(networks[network]);
        }

        async function connectWallet() {
            try {
                // Check if Phantom is installed
                const isPhantomInstalled = window.solana && window.solana.isPhantom;
                
                if (!isPhantomInstalled) {
                    alert("Please install Phantom wallet!");
                    window.open("https://phantom.app/", "_blank");
                    return;
                }

                // Connect to Phantom wallet
                const resp = await window.solana.connect();
                walletPublicKey = resp.publicKey.toString();
                
                // Update button text
                const connectButton = document.getElementById('connectWalletButton');
                connectButton.textContent = walletPublicKey.slice(0, 4) + '...' + walletPublicKey.slice(-4);
                
                // Add disconnect handler
                connectButton.onclick = disconnectWallet;
            } catch (err) {
                console.error("Error connecting to wallet:", err);
                alert("Failed to connect to wallet: " + err.message);
            }
        }

        async function disconnectWallet() {
            try {
                await window.solana.disconnect();
                walletPublicKey = null;
                
                // Reset button
                const connectButton = document.getElementById('connectWalletButton');
                connectButton.textContent = 'Connect Wallet';
                connectButton.onclick = connectWallet;
            } catch (err) {
                console.error("Error disconnecting from wallet:", err);
            }
        }

        function updateNetwork() {
            const network = document.getElementById('networkSelect').value;
            selectedNetwork = network;
            initializeConnection(network);
        }

        // Function to populate token dropdowns
        function populateBaseTokenDropdown() {
            const baseTokenDropdown = document.getElementById("baseToken");
            const quoteTokenDropdown = document.getElementById("quoteToken");
            const createdTokens = JSON.parse(localStorage.getItem("createdTokens")) || [];

            // Default options
            const defaultOptions = `
                <option value="SOL">SOL (Solana)</option>
                <option value="USDC">USDC</option>
                <option value="USDT">USDT</option>
            `;

            baseTokenDropdown.innerHTML = defaultOptions;
            quoteTokenDropdown.innerHTML = defaultOptions;

            // Add created tokens to the dropdowns
            createdTokens.forEach(token => {
                const baseOption = document.createElement("option");
                const quoteOption = document.createElement("option");
                
                baseOption.value = token;
                baseOption.innerText = token;
                quoteOption.value = token;
                quoteOption.innerText = token;
                
                baseTokenDropdown.appendChild(baseOption);
                quoteTokenDropdown.appendChild(quoteOption);
            });
        }

        // Handle form submission
        document.querySelector("form").addEventListener("submit", async function(event) {
            event.preventDefault();
            
            if (!walletPublicKey) {
                alert('Please connect your wallet first');
                return;
            }

            const baseToken = document.getElementById("baseToken").value;
            const quoteToken = document.getElementById("quoteToken").value;
            const liquidityAmount = parseFloat(document.getElementById("liquidityAmount").value);
            const feeTier = parseFloat(document.getElementById("feeTier").value);
            
            // Validation
            if (baseToken === quoteToken) {
                alert('Base token and quote token must be different');
                return;
            }

            if (isNaN(liquidityAmount) || liquidityAmount <= 0) {
                alert('Please enter a valid liquidity amount greater than 0');
                return;
            }

            try {
                document.getElementById("createLiquidityButton").disabled = true;
                document.getElementById("createLiquidityButton").textContent = "Creating Pool...";
                
                await createLiquidityPool(baseToken, quoteToken, liquidityAmount, feeTier);
                alert('Liquidity pool created successfully!');
            } catch (error) {
                alert("Failed to create liquidity pool: " + error.message);
            } finally {
                document.getElementById("createLiquidityButton").disabled = false;
                document.getElementById("createLiquidityButton").textContent = "Create Liquidity";
            }
        });

        async function createLiquidityPool(baseToken, quoteToken, liquidityAmount, feeTier) {
            try {
                if (!walletPublicKey) {
                    throw new Error('Wallet is not connected');
                }

                console.log(`Creating liquidity pool on ${selectedNetwork}:`);
                console.log(`Base Token: ${baseToken}`);
                console.log(`Quote Token: ${quoteToken}`);
                console.log(`Amount: ${liquidityAmount}`);
                console.log(`Fee Tier: ${feeTier}%`);

                // Here you would implement the actual liquidity pool creation
                // using Solana web3.js and your smart contract
                
                // Simulate transaction delay
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                return true;
            } catch (error) {
                console.error('Error creating liquidity pool:', error);
                throw error;
            }
        }
    </script>
</body>
</html>