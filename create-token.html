<!DOCTYPE html>
<html lang="en">
<head>
    <title>Create Token | SolMint</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.73.0/lib/index.iife.min.js"></script>
</head>
<body class="bg-gray-50 font-sans">

<!-- Header -->
<header class="bg-blue-600 text-white p-6">
    <div class="flex justify-center items-center flex-col">
        <h1 class="text-3xl font-bold">SolMint</h1>
        <nav class="mt-4 flex justify-center space-x-8">
            <a href="create-token.html" class="bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">
                Create Token
            </a>
            <a href="create-liquidity.html" class="bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">
                Create Liquidity Pool
            </a>
            <button id="connectWalletButton" onclick="connectWallet()" 
                class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400">
                Connect Wallet
            </button>
            <select id="networkSelect" onchange="updateNetwork()" class="bg-white text-blue-600 border rounded-md py-2 px-4 hover:border-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-600 transition duration-300">
                <option value="devnet">Devnet</option>
                <option value="testnet">Testnet</option>
                <option value="mainnet">Mainnet</option>
            </select>
        </nav>
    </div>
</header>

<!-- Main Content -->
<main class="p-8 grid grid-cols-1 md:grid-cols-2 gap-8">
    <section class="bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold mb-6">Create Your Token</h2>
        <form id="createTokenForm" onsubmit="event.preventDefault(); createToken();">
            <label for="tokenName" class="block text-sm font-medium">Token Name</label>
            <input type="text" id="tokenName" class="w-full p-3 border rounded-md mb-4" required>
            
            <label for="tokenSymbol" class="block text-sm font-medium">Token Symbol</label>
            <input type="text" id="tokenSymbol" class="w-full p-3 border rounded-md mb-4" required>
            
            <label for="totalSupply" class="block text-sm font-medium">Total Supply</label>
            <input type="number" id="totalSupply" class="w-full p-3 border rounded-md mb-4" required>
            
            <div class="flex items-center mb-4">
                <input type="checkbox" id="revokeMint" class="mr-2">
                <label for="revokeMint" class="text-sm font-medium">Revoke Mint Authority</label>
            </div>
    
            <div class="flex items-center mb-4">
                <input type="checkbox" id="freezeAuthority" class="mr-2">
                <label for="freezeAuthority" class="text-sm font-medium">Freeze Authority</label>
            </div>
            
            <button id="createTokenButton" class="bg-blue-600 text-white py-3 rounded-md">
                Create Token
            </button>
        </form>
    </section>
    <!-- Token Creation Description Section -->
<section class="bg-white p-6 rounded-lg shadow-lg">
    <h2 class="text-2xl font-bold mb-6">What is a Token?</h2>
    <p class="text-sm text-gray-700 mb-4">
        A token is a digital asset that represents ownership, value, or access to a specific service or product. In the context of SolanaMint, you can create custom tokens for various purposes like decentralized finance (DeFi), gaming, or as part of a tokenized ecosystem.
    </p>
    <h3 class="text-lg font-semibold mb-2">Key Features of Your Token</h3>
    <ul class="list-disc pl-5 text-sm text-gray-700">
        <li>Customizable token name and symbol</li>
        <li>Ability to set total supply and control token minting</li>
        <li>Manage permissions like freeze and revoke minting authority</li>
    </ul>
    <h3 class="text-lg font-semibold mb-2 mt-4">Why Create a Token?</h3>
    <p class="text-sm text-gray-700">
        Tokens are the backbone of blockchain projects, enabling the creation of decentralized ecosystems, rewards systems, and incentivized networks. By creating your own token, you can engage with new possibilities in blockchain technology.
    </p>
</section>
</main>
</main>

<!-- Footer -->
<footer class="bg-blue-600 text-white p-6 text-center mt-auto">
    <div class="container mx-auto">
        <p>&copy; 2024 SolMint | <a href="https://t.me/jinwoo5385" class="text-blue-300">Contact us</a></p>
    </div>
</footer>

<script>
    // Initialize Solana connection and state
    let connection;
    let walletPublicKey = null;
    let selectedNetwork = 'devnet'; // Default network

    // Initialize connection on page load
    window.addEventListener('load', () => {
        initializeConnection(selectedNetwork);
    });

    function initializeConnection(network) {
        const networks = {
            'devnet': 'https://api.devnet.solana.com',
            'testnet': 'https://api.testnet.solana.com',
            'mainnet': 'https://api.mainnet-beta.solana.com'
        };
        connection = new solanaWeb3.Connection(networks[network]);
    }

    async function connectWallet() {
        try {
            // Check if Phantom is installed
            const isPhantomInstalled = window.solana && window.solana.isPhantom;
            
            if (!isPhantomInstalled) {
                alert("Please install Phantom wallet!");
                window.open("https://phantom.app/", "_blank");
                return;
            }

            // Connect to Phantom wallet
            const resp = await window.solana.connect();
            walletPublicKey = resp.publicKey.toString();
            
            // Update button text
            const connectButton = document.getElementById('connectWalletButton');
            connectButton.textContent = walletPublicKey.slice(0, 4) + '...' + walletPublicKey.slice(-4);
            
            // Add disconnect handler
            connectButton.onclick = disconnectWallet;
        } catch (err) {
            console.error("Error connecting to wallet:", err);
            alert("Failed to connect to wallet: " + err.message);
        }
    }

    async function disconnectWallet() {
        try {
            await window.solana.disconnect();
            walletPublicKey = null;
            
            // Reset button
            const connectButton = document.getElementById('connectWalletButton');
            connectButton.textContent = 'Connect Wallet';
            connectButton.onclick = connectWallet;
        } catch (err) {
            console.error("Error disconnecting from wallet:", err);
        }
    }

    function updateNetwork() {
        const network = document.getElementById('networkSelect').value;
        selectedNetwork = network;
        initializeConnection(network);
    }

    // Create Token Action
    async function createToken() {
        if (!walletPublicKey) {
            alert("Please connect your wallet first.");
            return;
        }

        const tokenName = document.getElementById('tokenName').value.trim();
        const tokenSymbol = document.getElementById('tokenSymbol').value.trim();
        const totalSupply = parseFloat(document.getElementById('totalSupply').value);
        const revokeMint = document.getElementById('revokeMint').checked;
        const freezeAuthority = document.getElementById('freezeAuthority').checked;

        // Validate inputs
        if (!tokenName || !tokenSymbol || isNaN(totalSupply) || totalSupply <= 0) {
            alert("Please fill out all fields correctly. Total supply must be greater than 0.");
            return;
        }

        if (tokenSymbol.length > 10) {
            alert("Token symbol must be 10 characters or less.");
            return;
        }

        try {
            // Disable form during transaction
            document.getElementById('createTokenButton').disabled = true;
            document.getElementById('createTokenButton').innerText = 'Creating Token...';

            const transaction = new solanaWeb3.Transaction();
            const mint = await createTokenOnNetwork(tokenName, tokenSymbol, totalSupply, revokeMint, freezeAuthority);

            transaction.add(mint);
            
            const signedTransaction = await window.solana.signTransaction(transaction);
            const txId = await connection.sendRawTransaction(signedTransaction.serialize());
            
            // Store created token info in localStorage
            const tokens = JSON.parse(localStorage.getItem('createdTokens') || '[]');
            tokens.push(tokenSymbol);
            localStorage.setItem('createdTokens', JSON.stringify(tokens));

            alert(`Token created successfully!\nTransaction ID: ${txId}\nToken Symbol: ${tokenSymbol}`);
            console.log("Transaction sent:", txId);

            // Reset form
            document.getElementById('createTokenForm').reset();
        } catch (error) {
            console.error("Error creating token:", error);
            alert(`Failed to create token: ${error.message}`);
        } finally {
            // Re-enable form
            document.getElementById('createTokenButton').disabled = false;
            document.getElementById('createTokenButton').innerText = 'Create Token';
        }
    }

    // Create token on selected network
    async function createTokenOnNetwork(tokenName, tokenSymbol, totalSupply, revokeMint, freezeAuthority) {
        try {
            const mintAccount = solanaWeb3.Keypair.generate();
            const mintRent = await connection.getMinimumBalanceForRentExemption(solanaWeb3.MINT_LAYOUT.span);

            const createAccountInstruction = solanaWeb3.SystemProgram.createAccount({
                fromPubkey: new solanaWeb3.PublicKey(walletPublicKey),
                newAccountPubkey: mintAccount.publicKey,
                lamports: mintRent,
                space: solanaWeb3.MINT_LAYOUT.span,
                programId: solanaWeb3.TOKEN_PROGRAM_ID
            });

            const initMintInstruction = solanaWeb3.Token.createInitializeMintInstruction(
                solanaWeb3.TOKEN_PROGRAM_ID,
                mintAccount.publicKey,
                9, // decimals
                new solanaWeb3.PublicKey(walletPublicKey),
                freezeAuthority ? new solanaWeb3.PublicKey(walletPublicKey) : null
            );

            const transaction = new solanaWeb3.Transaction()
                .add(createAccountInstruction)
                .add(initMintInstruction);

            if (revokeMint) {
                // Add instruction to revoke mint authority
                transaction.add(
                    solanaWeb3.Token.createSetAuthorityInstruction(
                        solanaWeb3.TOKEN_PROGRAM_ID,
                        mintAccount.publicKey,
                        null,
                        'MintTokens',
                        new solanaWeb3.PublicKey(walletPublicKey),
                        []
                    )
                );
            }

            return transaction;
        } catch (error) {
            console.error('Error in createTokenOnNetwork:', error);
            throw new Error('Failed to create token instructions');
        }
    }
</script>

<div id="modal-container"></div>
</body>
</html>